{"version":3,"sources":["../src/daemon/server.ts","../src/daemon/store.ts","../src/daemon/websocket.ts","../src/notify/index.ts","../src/types.ts","../src/daemon/zombie.ts","../src/daemon/index.ts"],"sourcesContent":["// src/daemon/server.ts\nimport express, { type Request, type Response } from 'express';\nimport { createServer as createHttpServer, type Server } from 'http';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport type { Session, ApiResponse, ApiErrorResponse, RegisterSessionRequest, UpdateSessionRequest, SessionEvent } from '../types.js';\nimport { sessionStore } from './store.js';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nconst app = express();\napp.use(express.json());\n\n// 静态文件服务 (Dashboard)\nconst publicPath = path.join(__dirname, 'public');\napp.use('/dashboard', express.static(publicPath));\n\n// 主页重定向到 Dashboard\napp.get('/', (_req, res) => {\n  res.redirect('/dashboard');\n});\n\n/**\n * 成功响应辅助函数\n */\nfunction success<T>(data: T): ApiResponse<T> {\n  return { success: true, data };\n}\n\n/**\n * 错误响应辅助函数\n */\nfunction error(code: string, message: string): ApiErrorResponse {\n  return { success: false, error: { code, message } };\n}\n\n/**\n * POST /api/sessions - 注册新会话\n */\napp.post('/api/sessions', (req: Request<object, ApiResponse<Session> | ApiErrorResponse, RegisterSessionRequest>, res: Response<ApiResponse<Session> | ApiErrorResponse>) => {\n  const { pid, ppid, terminal, cwd } = req.body;\n\n  if (!pid || !ppid || !cwd) {\n    res.status(400).json(error('INVALID_REQUEST', 'Missing required fields: pid, ppid, cwd'));\n    return;\n  }\n\n  const session = sessionStore.register({ pid, ppid, terminal: terminal || 'unknown', cwd });\n  res.status(201).json(success(session));\n});\n\n/**\n * GET /api/sessions - 获取所有会话\n */\napp.get('/api/sessions', (_req: Request, res: Response<ApiResponse<Session[]>>) => {\n  const sessions = sessionStore.getAll();\n  res.json(success(sessions));\n});\n\n/**\n * GET /api/sessions/:pid - 获取单个会话\n */\napp.get('/api/sessions/:pid', (req: Request<{ pid: string }>, res: Response<ApiResponse<Session> | ApiErrorResponse>) => {\n  const pid = parseInt(req.params.pid, 10);\n\n  if (isNaN(pid)) {\n    res.status(400).json(error('INVALID_PID', 'Invalid PID format'));\n    return;\n  }\n\n  const session = sessionStore.get(pid);\n  if (!session) {\n    res.status(404).json(error('SESSION_NOT_FOUND', `Session with PID ${pid} not found`));\n    return;\n  }\n\n  res.json(success(session));\n});\n\n/**\n * PATCH /api/sessions/:pid - 更新会话状态\n */\napp.patch('/api/sessions/:pid', (req: Request<{ pid: string }, ApiResponse<Session> | ApiErrorResponse, UpdateSessionRequest>, res: Response<ApiResponse<Session> | ApiErrorResponse>) => {\n  const pid = parseInt(req.params.pid, 10);\n\n  if (isNaN(pid)) {\n    res.status(400).json(error('INVALID_PID', 'Invalid PID format'));\n    return;\n  }\n\n  const { status, message } = req.body;\n  if (!status) {\n    res.status(400).json(error('INVALID_REQUEST', 'Missing required field: status'));\n    return;\n  }\n\n  const session = sessionStore.update(pid, status, message);\n  if (!session) {\n    res.status(404).json(error('SESSION_NOT_FOUND', `Session with PID ${pid} not found`));\n    return;\n  }\n\n  res.json(success(session));\n});\n\n/**\n * DELETE /api/sessions/:pid - 注销会话\n */\napp.delete('/api/sessions/:pid', (req: Request<{ pid: string }>, res: Response<ApiResponse<null> | ApiErrorResponse>) => {\n  const pid = parseInt(req.params.pid, 10);\n\n  if (isNaN(pid)) {\n    res.status(400).json(error('INVALID_PID', 'Invalid PID format'));\n    return;\n  }\n\n  const deleted = sessionStore.delete(pid);\n  if (!deleted) {\n    res.status(404).json(error('SESSION_NOT_FOUND', `Session with PID ${pid} not found`));\n    return;\n  }\n\n  res.json(success(null));\n});\n\n/**\n * GET /api/health - 健康检查\n */\napp.get('/api/health', (_req: Request, res: Response<ApiResponse<{ status: string; sessions: number }>>) => {\n  res.json(success({ status: 'ok', sessions: sessionStore.count }));\n});\n\n/**\n * GET /api/events - 获取事件历史\n */\napp.get('/api/events', (_req: Request, res: Response<ApiResponse<SessionEvent[]>>) => {\n  const events = sessionStore.getEvents();\n  res.json(success(events));\n});\n\n/**\n * 创建并配置 HTTP 服务器\n */\nexport function createServer(): Server {\n  const httpServer = createHttpServer(app);\n  return httpServer;\n}\n","// src/daemon/store.ts\nimport type { Session, RegisterSessionRequest, SessionStatus, SessionEvent, SessionEventType } from '../types.js';\n\n/**\n * 会话存储管理器\n * 负责管理所有 Claude Code 会话的状态\n */\nexport class SessionStore {\n  private sessions: Map<number, Session> = new Map();\n  private events: SessionEvent[] = [];\n  private readonly MAX_EVENTS = 100;\n\n  /**\n   * 注册新会话\n   */\n  register(request: RegisterSessionRequest): Session {\n    const now = Date.now();\n    const project = this.extractProjectName(request.cwd);\n\n    const session: Session = {\n      pid: request.pid,\n      ppid: request.ppid,\n      terminal: this.normalizeTerminal(request.terminal),\n      cwd: request.cwd,\n      project,\n      status: 'running',\n      startedAt: now,\n      updatedAt: now,\n    };\n\n    this.sessions.set(session.pid, session);\n    this.addEvent('started', session);\n    return session;\n  }\n\n  /**\n   * 获取单个会话\n   */\n  get(pid: number): Session | undefined {\n    return this.sessions.get(pid);\n  }\n\n  /**\n   * 获取所有会话\n   */\n  getAll(): Session[] {\n    return Array.from(this.sessions.values());\n  }\n\n  /**\n   * 更新会话状态\n   */\n  update(pid: number, status: SessionStatus, message?: string): Session | undefined {\n    const session = this.sessions.get(pid);\n    if (!session) return undefined;\n\n    const oldStatus = session.status;\n    session.status = status;\n    session.updatedAt = Date.now();\n    if (message !== undefined) {\n      session.message = message;\n    }\n\n    // 记录状态变更事件\n    if (status === 'waiting') {\n      this.addEvent('waiting', session);\n    } else if (oldStatus === 'waiting' && status === 'running') {\n      this.addEvent('resumed', session);\n    }\n\n    return session;\n  }\n\n  /**\n   * 删除会话\n   */\n  delete(pid: number): boolean {\n    const session = this.sessions.get(pid);\n    if (session) {\n      this.addEvent('ended', session);\n    }\n    return this.sessions.delete(pid);\n  }\n\n  /**\n   * 获取活跃会话数量\n   */\n  get count(): number {\n    return this.sessions.size;\n  }\n\n  /**\n   * 记录事件\n   */\n  addEvent(type: SessionEventType, session: Session): SessionEvent {\n    const event: SessionEvent = {\n      id: `${session.pid}-${Date.now()}`,\n      type,\n      pid: session.pid,\n      project: session.project,\n      timestamp: Date.now(),\n      message: session.message,\n    };\n\n    this.events.unshift(event);\n\n    // 保留最近 100 条事件\n    if (this.events.length > this.MAX_EVENTS) {\n      this.events = this.events.slice(0, this.MAX_EVENTS);\n    }\n\n    return event;\n  }\n\n  /**\n   * 获取所有事件\n   */\n  getEvents(): SessionEvent[] {\n    return this.events;\n  }\n\n  /**\n   * 清除所有事件\n   */\n  clearEvents(): void {\n    this.events = [];\n  }\n\n  /**\n   * 从路径提取项目名称\n   */\n  private extractProjectName(cwd: string): string {\n    const parts = cwd.split('/');\n    return parts[parts.length - 1] || 'unknown';\n  }\n\n  /**\n   * 标准化终端类型\n   */\n  private normalizeTerminal(terminal: string): Session['terminal'] {\n    const terminalMap: Record<string, Session['terminal']> = {\n      'vscode': 'vscode',\n      'iTerm.app': 'iterm',\n      'iTerm': 'iterm',\n      'WarpTerminal': 'warp',\n      'Warp': 'warp',\n      'Apple_Terminal': 'terminal',\n      'Terminal': 'terminal',\n    };\n\n    return terminalMap[terminal] || 'unknown';\n  }\n}\n\n// 单例导出\nexport const sessionStore = new SessionStore();\n","// src/daemon/websocket.ts\nimport { WebSocketServer, WebSocket } from 'ws';\nimport type { Server } from 'http';\nimport type { ServerMessage, ClientMessage } from '../types.js';\nimport { sessionStore } from './store.js';\n\nlet wss: WebSocketServer | null = null;\nconst clients = new Set<WebSocket>();\n\n/**\n * 初始化 WebSocket 服务器\n */\nexport function initWebSocket(server: Server): void {\n  wss = new WebSocketServer({ server, path: '/ws' });\n\n  wss.on('connection', (ws: WebSocket) => {\n    clients.add(ws);\n    console.log(`WebSocket client connected. Total: ${clients.size}`);\n\n    // 发送初始化数据\n    sendMessage(ws, {\n      type: 'init',\n      sessions: sessionStore.getAll(),\n      events: sessionStore.getEvents(),\n    });\n\n    ws.on('message', (data: Buffer) => {\n      try {\n        const msg: ClientMessage = JSON.parse(data.toString());\n        handleClientMessage(ws, msg);\n      } catch (err) {\n        console.error('Failed to parse WebSocket message:', err);\n      }\n    });\n\n    ws.on('close', () => {\n      clients.delete(ws);\n      console.log(`WebSocket client disconnected. Total: ${clients.size}`);\n    });\n  });\n}\n\n/**\n * 广播消息给所有客户端\n */\nexport function broadcast(message: ServerMessage): void {\n  const data = JSON.stringify(message);\n  clients.forEach(client => {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(data);\n    }\n  });\n}\n\n/**\n * 发送消息给单个客户端\n */\nfunction sendMessage(ws: WebSocket, message: ServerMessage): void {\n  if (ws.readyState === WebSocket.OPEN) {\n    ws.send(JSON.stringify(message));\n  }\n}\n\n/**\n * 处理客户端消息\n */\nfunction handleClientMessage(ws: WebSocket, msg: ClientMessage): void {\n  switch (msg.type) {\n    case 'kill_session':\n      // 删除会话\n      const session = sessionStore.get(msg.pid);\n      if (session) {\n        sessionStore.addEvent('killed', session);\n        sessionStore.delete(msg.pid);\n        broadcast({ type: 'session_removed', pid: msg.pid });\n      }\n      break;\n  }\n}\n","// src/notify/index.ts\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport type { Session, TerminalType } from '../types.js';\nimport { TERMINAL_BUNDLE_ID } from '../types.js';\n\nconst execAsync = promisify(exec);\n\n/**\n * 发送 macOS 系统通知\n */\nexport async function sendNotification(\n  title: string,\n  message: string,\n  sound: string = 'Glass'\n): Promise<void> {\n  const script = `\n    display notification \"${escapeString(message)}\" with title \"${escapeString(title)}\" sound name \"${sound}\"\n  `;\n  await runOsascript(script);\n}\n\n/**\n * 显示等待输入的悬浮对话框\n * @returns 用户点击的按钮 ('ignore' | 'goto' | 'timeout')\n */\nexport async function showWaitingDialog(\n  session: Session,\n  timeoutSeconds: number = 300\n): Promise<'ignore' | 'goto' | 'timeout'> {\n  const script = `\n    display dialog \"Claude 等待输入中...\" ¬\n      buttons {\"忽略\", \"前往\"} ¬\n      default button \"前往\" ¬\n      with title \"Claude Monitor - ${escapeString(session.project)}\" ¬\n      giving up after ${timeoutSeconds}\n  `;\n\n  try {\n    const result = await runOsascript(script);\n    // 解析返回值: {button returned:\"前往\"} 或 {gave up:true}\n    if (result.includes('gave up:true')) {\n      return 'timeout';\n    }\n    if (result.includes('button returned:忽略')) {\n      return 'ignore';\n    }\n    return 'goto';\n  } catch {\n    return 'timeout';\n  }\n}\n\n/**\n * 激活终端窗口\n */\nexport async function activateTerminal(terminal: TerminalType): Promise<void> {\n  const bundleId = TERMINAL_BUNDLE_ID[terminal];\n  const script = `tell application id \"${bundleId}\" to activate`;\n  await runOsascript(script);\n}\n\n/**\n * 运行 osascript\n */\nasync function runOsascript(script: string): Promise<string> {\n  const { stdout } = await execAsync(`osascript -e '${script.replace(/'/g, \"'\\\"'\\\"'\")}'`);\n  return stdout.trim();\n}\n\n/**\n * 转义 AppleScript 字符串中的特殊字符\n */\nfunction escapeString(str: string): string {\n  return str.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n}\n","/**\n * Claude Code Monitor - 类型定义\n */\n\n// 终端类型\nexport type TerminalType = 'vscode' | 'iterm' | 'warp' | 'terminal' | 'unknown';\n\n// 会话状态\nexport type SessionStatus = 'running' | 'waiting' | 'ended';\n\n// 会话信息\nexport interface Session {\n  /** Claude Code 进程 ID */\n  pid: number;\n  /** 父进程 ID (终端进程) */\n  ppid: number;\n  /** 终端类型 */\n  terminal: TerminalType;\n  /** 工作目录 */\n  cwd: string;\n  /** 项目名称 (目录名) */\n  project: string;\n  /** 会话状态 */\n  status: SessionStatus;\n  /** 开始时间戳 */\n  startedAt: number;\n  /** 最后更新时间戳 */\n  updatedAt: number;\n  /** 等待原因 (status 为 waiting 时) */\n  message?: string;\n}\n\n// 注册会话请求\nexport interface RegisterSessionRequest {\n  pid: number;\n  ppid: number;\n  terminal: string;\n  cwd: string;\n}\n\n// 更新会话请求\nexport interface UpdateSessionRequest {\n  status: SessionStatus;\n  message?: string;\n}\n\n// API 响应\nexport interface ApiResponse<T = unknown> {\n  success: true;\n  data: T;\n}\n\n// API 错误响应\nexport interface ApiErrorResponse {\n  success: false;\n  error: {\n    code: string;\n    message: string;\n  };\n}\n\n// 配置\nexport interface Config {\n  /** 守护进程端口 */\n  port: number;\n  /** 僵尸检测间隔 (ms) */\n  checkInterval: number;\n  /** 通知配置 */\n  notifications: {\n    sessionEnd: boolean;\n    promptSubmit: boolean;\n    waitingInput: boolean;\n  };\n  /** 音效配置 */\n  sounds: {\n    sessionEnd: string;\n    promptSubmit: string;\n    waitingInput: string;\n  };\n}\n\n// 默认配置\nexport const DEFAULT_CONFIG: Config = {\n  port: 17530,\n  checkInterval: 5000,\n  notifications: {\n    sessionEnd: true,\n    promptSubmit: false,\n    waitingInput: true,\n  },\n  sounds: {\n    sessionEnd: 'Glass',\n    promptSubmit: 'Submarine',\n    waitingInput: 'Hero',\n  },\n};\n\n// 终端 Bundle ID 映射\nexport const TERMINAL_BUNDLE_ID: Record<TerminalType, string> = {\n  vscode: 'com.microsoft.VSCode',\n  iterm: 'com.googlecode.iterm2',\n  warp: 'dev.warp.Warp-Stable',\n  terminal: 'com.apple.Terminal',\n  unknown: 'com.apple.Terminal',\n};\n\n// 会话事件类型\nexport type SessionEventType = 'started' | 'ended' | 'waiting' | 'resumed' | 'killed';\n\n// 会话事件\nexport interface SessionEvent {\n  id: string;\n  type: SessionEventType;\n  pid: number;\n  project: string;\n  timestamp: number;\n  message?: string;\n}\n\n// WebSocket 消息类型\nexport type ServerMessage =\n  | { type: 'init'; sessions: Session[]; events: SessionEvent[] }\n  | { type: 'session_update'; session: Session }\n  | { type: 'session_removed'; pid: number }\n  | { type: 'new_event'; event: SessionEvent };\n\nexport type ClientMessage =\n  | { type: 'kill_session'; pid: number };\n","// src/daemon/zombie.ts\nimport { sessionStore } from './store.js';\nimport { sendNotification } from '../notify/index.js';\nimport { DEFAULT_CONFIG } from '../types.js';\n\nlet checkInterval: ReturnType<typeof setInterval> | null = null;\n\n/**\n * 启动僵尸进程检测\n */\nexport function startZombieChecker(intervalMs: number = DEFAULT_CONFIG.checkInterval): void {\n  if (checkInterval) {\n    console.log('Zombie checker already running');\n    return;\n  }\n\n  console.log(`Starting zombie checker (interval: ${intervalMs}ms)`);\n\n  checkInterval = setInterval(async () => {\n    const sessions = sessionStore.getAll();\n\n    for (const session of sessions) {\n      if (!isProcessAlive(session.pid)) {\n        console.log(`Detected zombie session: PID ${session.pid} (${session.project})`);\n        sessionStore.delete(session.pid);\n\n        // 发送通知\n        try {\n          await sendNotification(\n            'Claude Monitor - 会话异常终止',\n            `项目: ${session.project}`,\n            'Basso'\n          );\n        } catch (err) {\n          console.error('Failed to send notification:', err);\n        }\n      }\n    }\n  }, intervalMs);\n}\n\n/**\n * 停止僵尸进程检测\n */\nexport function stopZombieChecker(): void {\n  if (checkInterval) {\n    clearInterval(checkInterval);\n    checkInterval = null;\n    console.log('Zombie checker stopped');\n  }\n}\n\n/**\n * 检查进程是否存活\n */\nfunction isProcessAlive(pid: number): boolean {\n  try {\n    // 发送信号 0 检查进程是否存在\n    process.kill(pid, 0);\n    return true;\n  } catch {\n    return false;\n  }\n}\n","// src/daemon/index.ts\nimport { createServer } from './server.js';\nimport { initWebSocket, broadcast } from './websocket.js';\nimport { startZombieChecker, stopZombieChecker } from './zombie.js';\nimport { sessionStore } from './store.js';\nimport { DEFAULT_CONFIG } from '../types.js';\n\nconst PORT = process.env.PORT ? parseInt(process.env.PORT, 10) : DEFAULT_CONFIG.port;\n\nconst httpServer = createServer();\n\n// 初始化 WebSocket\ninitWebSocket(httpServer);\n\n// 监听 store 变化并广播\nconst originalRegister = sessionStore.register.bind(sessionStore);\nconst originalUpdate = sessionStore.update.bind(sessionStore);\nconst originalDelete = sessionStore.delete.bind(sessionStore);\n\nsessionStore.register = (req) => {\n  const session = originalRegister(req);\n  broadcast({ type: 'session_update', session });\n  return session;\n};\n\nsessionStore.update = (pid, status, message) => {\n  const session = originalUpdate(pid, status, message);\n  if (session) {\n    broadcast({ type: 'session_update', session });\n  }\n  return session;\n};\n\nsessionStore.delete = (pid) => {\n  const result = originalDelete(pid);\n  if (result) {\n    broadcast({ type: 'session_removed', pid });\n  }\n  return result;\n};\n\nhttpServer.listen(PORT, () => {\n  console.log(`Claude Monitor Daemon started on port ${PORT}`);\n  console.log(`API: http://localhost:${PORT}/api`);\n  console.log(`Dashboard: http://localhost:${PORT}/dashboard`);\n  console.log(`Health: http://localhost:${PORT}/api/health`);\n\n  startZombieChecker(DEFAULT_CONFIG.checkInterval);\n});\n\nconst shutdown = () => {\n  console.log('Shutting down gracefully...');\n  stopZombieChecker();\n  httpServer.close(() => {\n    console.log('Server closed');\n    process.exit(0);\n  });\n};\n\nprocess.on('SIGTERM', shutdown);\nprocess.on('SIGINT', shutdown);\n"],"mappings":"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","names":["httpServer"]}